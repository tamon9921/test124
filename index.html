<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js GLB Animation with Orbit Controls</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>

<!-- ES Modules 用に CDN を使用 -->
<script type="module">

    // 必要なモジュールをインポート
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/loaders/GLTFLoader.js';

    // シーン、カメラ、レンダラーの初期化
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    // 照明の追加
    const light = new THREE.DirectionalLight( 0xffffff, 1 );
    light.position.set( 1, 1, 1 ).normalize();
    scene.add( light );

    // カメラ操作のためのOrbitControlsを追加
    const controls = new OrbitControls( camera, renderer.domElement );
    camera.position.set( 0.54, 1.729, 4.127 ); // カメラの初期位置

    // GLBファイルを読み込むためのGLTFLoader
    const loader = new GLTFLoader();
    let mixer; // アニメーションミキサーを定義

    loader.load( 'path_to_your_model.glb', function ( gltf ) {

        const model = gltf.scene;
        scene.add( model );

        // アニメーションが含まれている場合、アニメーションミキサーをセットアップ
        if (gltf.animations && gltf.animations.length) {
            mixer = new THREE.AnimationMixer(model);
            gltf.animations.forEach(function (clip) {
                const action = mixer.clipAction(clip);
                action.play(); // アニメーションを再生
            });
        }

        // ウィンドウのリサイズ処理
        window.addEventListener('resize', function () {
            const width = window.innerWidth;
            const height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });

        // 毎フレームのレンダリング
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame( animate );

            // アニメーションの更新
            if (mixer) {
                const delta = clock.getDelta();
                mixer.update(delta);
            }

            controls.update(); // カメラ操作の更新
            renderer.render( scene, camera );
        }
        animate();

    }, undefined, function ( error ) {
        console.error( 'Error loading GLB file: ', error );
    });

</script>

</body>
</html>
